{"version":3,"sources":["../../../src/vra/catalog/index.js"],"names":["requestPromise","promisifyAll","require","module","exports","getAllCatalogItems","getCatalogItemByName","getCatalogItemTemplate","submitRequest","getRequestsByCatalogItemName","getRequest","getRequests","sendRequestViaUrl","getResources","getResourceByName","getResourceById","getResourceActions","getResourceActionTemplate","getResourceActionRequests","submitResourceAction","getEntitlementByName","updateEntitlement","_this","resolve","reject","options","method","agent","config","url","hostname","headers","token","body","json","getAsync","then","response","statusCode","items","content","forEach","item","res","name","id","catalogItemId","submitRequestUrl","links","href","submitRequestUrlMethod","rel","push","catch","error"],"mappings":"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","file":"index.js","sourcesContent":["import Promise from 'bluebird'\nimport requests from './requests'\nimport resources from './resources'\nimport entitlements from './entitlements'\nvar requestPromise = Promise.promisifyAll(require('request'))\n\n/* istanbul ignore next */\nmodule.exports = {\n  getAllCatalogItems: getAllCatalogItems,\n  getCatalogItemByName: getCatalogItemByName,\n  getCatalogItemTemplate: getCatalogItemTemplate,\n  submitRequest: requests.submitRequest,\n  getRequestsByCatalogItemName: requests.getRequestsByCatalogItemName,\n  getRequest: requests.getRequest,\n  getRequests: requests.getRequests,\n  sendRequestViaUrl: requests.sendRequestViaUrl,\n  getResources: resources.getResources,\n  getResourceByName: resources.getResourceByName,\n  getResourceById: resources.getResourceById,\n  getResourceActions: resources.getResourceActions,\n  getResourceActionTemplate: resources.getResourceActionTemplate,\n  getResourceActionRequests: resources.getResourceActionRequests,\n  submitResourceAction: resources.submitResourceAction,\n  getEntitlementByName: entitlements.getEntitlementByName,\n  updateEntitlement: entitlements.updateEntitlement\n\n}\n\nfunction getAllCatalogItems () {\n  var _this = this\n\n  return new Promise(function (resolve, reject) {\n    var options = {\n      method: 'GET',\n      agent: _this.config.agent,\n      url: `https://${_this.config.hostname}/catalog-service/api/consumer/entitledCatalogItemViews?limit=1000`,\n      headers: {\n        'cache-control': 'no-cache',\n        'content-type': 'application/json',\n        'authorization': `Bearer ${_this.config.token}`\n      },\n      body: {},\n      json: true\n    }\n\n    requestPromise.getAsync(options)\n      .then(function (response) {\n        if (response.statusCode !== 200) {\n          return reject(response.body)\n        }\n\n        let items = []\n        response.body.content.forEach(function (item) {\n          var res = {}\n          res.name = item.name\n          res.id = item.catalogItemId\n          res.submitRequestUrl = item.links[1].href\n          res.submitRequestUrlMethod = item.links[1].rel\n          // res.catalogResourceLabel = item.catalogResource.label\n          // res.catalogResourceId = item.catalogResource.id\n          items.push(res)\n        }, this)\n        resolve(items)\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n\nfunction getCatalogItemByName (name) {\n  var _this = this\n\n  return new Promise(function (resolve, reject) {\n    var options = {\n      method: 'GET',\n      agent: _this.config.agent,\n      url: `https://${_this.config.hostname}/catalog-service/api/consumer/entitledCatalogItemViews?limit=1000&$filter=(name eq '${name}')`,\n      headers: {\n        'cache-control': 'no-cache',\n        'content-type': 'application/json',\n        'authorization': `Bearer ${_this.config.token}`\n      },\n      body: {},\n      json: true\n    }\n\n    requestPromise.getAsync(options)\n      .then(function (response) {\n        if (response.statusCode !== 200) {\n          return reject(response.body)\n        } else {\n          resolve(response.body.content[0])\n        }\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n\nfunction getCatalogItemTemplate (url) {\n  var _this = this\n\n  return new Promise(function (resolve, reject) {\n    var options = {\n      method: 'GET',\n      agent: _this.config.agent,\n      url: url,\n      headers: {\n        'cache-control': 'no-cache',\n        'content-type': 'application/json',\n        'authorization': `Bearer ${_this.config.token}`\n      },\n      body: {},\n      json: true\n    }\n\n    requestPromise.getAsync(options)\n      .then(function (response) {\n        if (response.statusCode !== 200) {\n          return reject(response.body)\n        }\n        return resolve(response.body)\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n"]}