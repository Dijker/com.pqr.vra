{"version":3,"sources":["../../src/vra/content.js"],"names":["requestPromise","promisifyAll","require","module","exports","getFromTenant","exportPackage","createPackage","getPackageById","deletePackage","tenantId","limit","_this","resolve","reject","options","method","agent","config","url","hostname","headers","token","json","getAsync","then","response","catch","error","contentZipPath","resolutionMode","formData","file","createReadStream","postAsync","packageName","contents","body","name","id","encoding","deleteAsync"],"mappings":"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","file":"content.js","sourcesContent":["import Promise from 'bluebird'\nimport fs from 'fs'\nvar requestPromise = Promise.promisifyAll(require('request'))\n\nmodule.exports = {\n  getFromTenant: getFromTenant,\n  exportPackage: exportPackage,\n  createPackage: createPackage,\n  getPackageById: getPackageById,\n  deletePackage: deletePackage\n}\n\nfunction getFromTenant (tenantId, limit) {\n  var _this = this\n  limit = limit || 1000\n  return new Promise(function (resolve, reject) {\n    var options\n    options = {\n      method: 'GET',\n      agent: _this.config.agent,\n      url: `https://${_this.config.hostname}/content-management-service/api/contents/?limit=${limit}&$filter=(tenantId eq '${tenantId}')`,\n      headers: {\n        'cache-control': 'no-cache',\n        'authorization': `Bearer ${_this.config.token}`\n      },\n      json: true\n    }\n\n    requestPromise.getAsync(options)\n      .then(function (response) {\n        return resolve(response)\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n\nfunction exportPackage (contentZipPath, resolutionMode) {\n  var _this = this\n\n  return new Promise(function (resolve, reject) {\n    var options\n\n    options = {\n      method: 'POST',\n      agent: _this.config.agent,\n      url: `https://${_this.config.hostname}/content-management-service/api/packages/?resolutionMode=${resolutionMode}`,\n      headers: {\n        'cache-control': 'no-cache',\n        'authorization': `Bearer ${_this.config.token}`\n      },\n      formData: {file: fs.createReadStream(contentZipPath)},\n      json: true\n    }\n\n    requestPromise.postAsync(options)\n      .then(function (response) {\n        return resolve(response)\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n\nfunction createPackage (packageName, tenantId, contents) {\n  var _this = this\n\n  return new Promise(function (resolve, reject) {\n    var options\n\n    options = {\n      method: 'POST',\n      agent: _this.config.agent,\n      url: `https://${_this.config.hostname}/content-management-service/api/packages`,\n      headers: {\n        'cache-control': 'no-cache',\n        'authorization': `Bearer ${_this.config.token}`,\n        'accept': 'application/json'\n      },\n      body: {\n        name: packageName,\n        contents: contents,\n        tenantId: tenantId\n      },\n      json: true\n    }\n\n    requestPromise.postAsync(options)\n      .then(function (response) {\n        return resolve(response)\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n\nfunction getPackageById (id) {\n  var _this = this\n\n  return new Promise(function (resolve, reject) {\n    var options\n\n    options = {\n      method: 'GET',\n      agent: _this.config.agent,\n      url: `https://${_this.config.hostname}/content-management-service/api/packages/${id}`,\n      headers: {\n        'cache-control': 'no-cache',\n        'authorization': `Bearer ${_this.config.token}`,\n        'accept': 'application/zip'\n      },\n      encoding: null\n    }\n\n    requestPromise.getAsync(options)\n      .then(function (response) {\n        return resolve(response)\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n\nfunction deletePackage (id) {\n  var _this = this\n\n  return new Promise(function (resolve, reject) {\n    var options\n\n    options = {\n      method: 'DELETE',\n      agent: _this.config.agent,\n      url: `https://${_this.config.hostname}/content-management-service/api/packages/${id}`,\n      headers: {\n        'cache-control': 'no-cache',\n        'authorization': `Bearer ${_this.config.token}`,\n        'accept': 'application/json'\n      },\n      json: true\n    }\n\n    requestPromise.deleteAsync(options)\n      .then(function (response) {\n        return resolve(response)\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n"]}