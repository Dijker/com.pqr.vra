{"version":3,"sources":["../../src/vro/actions.js"],"names":["_filter","require","requestPromise","promisifyAll","module","exports","importOne","exportToModuleName","importFromModuleName","moduleName","actionPath","password","_this","resolve","reject","options","method","agent","config","url","hostname","headers","Buffer","username","toString","qs","categoryName","overwrite","formData","file","createReadStream","json","error","postAsync","then","response","catch","actionId","encoding","getAsync","statusCode","body","link","length","filteredActions","attributes","i","attribute","isInModule","name","value","startsWith"],"mappings":"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","file":"actions.js","sourcesContent":["import fs from 'fs'\nimport Promise from 'bluebird'\nvar _filter = require('lodash.filter')\nvar requestPromise = Promise.promisifyAll(require('request'))\n\nmodule.exports = {\n  importOne: importOne,\n  exportToModuleName: exportToModuleName,\n  importFromModuleName: importFromModuleName\n}\n\nfunction exportToModuleName (moduleName, actionPath, password) {\n  var _this = this\n  return new Promise(function (resolve, reject) {\n    var options\n    try {\n      options = {\n        method: 'POST',\n        agent: _this.config.agent,\n        url: `https://${_this.config.hostname}/vco/api/actions/`,\n        headers: {\n          'cache-control': 'no-cache',\n          'authorization': 'Basic ' + new Buffer(_this.config.username + ':' + password).toString('base64')\n        },\n        qs: {\n          categoryName: moduleName,\n          overwrite: true\n        },\n        formData: {file: fs.createReadStream(actionPath)},\n        json: true\n      }\n    } catch (error) {\n      return reject(error)\n    }\n\n    requestPromise.postAsync(options)\n      .then(function (response) {\n        return resolve(response)\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n\nfunction importOne (actionId, password) {\n  var _this = this\n\n  return new Promise(function (resolve, reject) {\n    var options\n    options = {\n      method: 'GET',\n      agent: _this.config.agent,\n      url: `https://${_this.config.hostname}/vco/api/actions/${actionId}`,\n      headers: {\n        'cache-control': 'no-cache',\n        'authorization': 'Basic ' + new Buffer(_this.config.username + ':' + password).toString('base64'),\n        'accept': 'application/zip'\n      },\n      encoding: null\n    }\n\n    requestPromise.getAsync(options)\n      .then(function (response) {\n        return resolve(response)\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n\nfunction importFromModuleName (moduleName, password) {\n  var _this = this\n\n  return new Promise(function (resolve, reject) {\n    var options\n    options = {\n      method: 'GET',\n      agent: _this.config.agent,\n      url: `https://${_this.config.hostname}/vco/api/actions/`,\n      headers: {\n        'cache-control': 'no-cache',\n        'authorization': 'Basic ' + new Buffer(_this.config.username + ':' + password).toString('base64'),\n        'accept': 'application/json'\n      },\n      encoding: 'utf-8',\n      json: true\n    }\n\n    requestPromise.getAsync(options)\n      .then(function (response) {\n        if (response.statusCode && response.statusCode >= 200 && response.statusCode < 300 && response.body && response.body.link && response.body.link.length > 0) {\n          var filteredActions = _filter(response.body.link, function (link) {\n            if (link.attributes) {\n              for (var i = 0; i < link.attributes.length; i++) {\n                var attribute = link.attributes[i]\n                var isInModule = attribute.name === 'fqn' && attribute.value.startsWith(moduleName)\n                if (isInModule) {\n                  return true\n                }\n              }\n            }\n            return false\n          })\n          response.body.link = filteredActions\n        }\n        return resolve(response)\n      })\n      .catch(function (error) {\n        reject(error)\n      })\n  })\n}\n"]}